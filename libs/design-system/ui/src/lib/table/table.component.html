<div class="table-wrapper">
  <table>
    <thead>
      <tr>
        @for (col of columns; track col) {
          <th
            [class.truncate]="truncateHeaders"
            [ngStyle]="{ width: col.width }"
            >
            @if (
              !filterTemplates[col.propertyName]?.templateRef && !col.sortable
              ) {
              {{ col.displayName }}
            }
            @if (
              filterTemplates[col.propertyName]?.templateRef || col.sortable
              ) {
              @if (col.sortable) {
                <ng-container
                  [ngTemplateOutlet]="sortHeader"
                  [ngTemplateOutletContext]="{ column: col }"
                ></ng-container>
              }
            }
          </th>
        }
      </tr>
    </thead>
    <tbody>
      @for (element of dataSource; track element; let i = $index) {
        <tr
          (click)="onRowClick(element)"
          >
          @for (col of columns; track col) {
            <td>
              <div class="tbody-cell" [class.d-center]="col.center">
                <ng-container
              *ngTemplateOutlet="
                columnTemplates[col.propertyName]?.templateRef || defaultCell;
                context: { item: element, col: col.propertyName, i: i }
              "
                ></ng-container>
              </div>
            </td>
          }
        </tr>
      }
    </tbody>
    <tfoot>
      <tr>
        <td [attr.colspan]="columns.length">
          <div class="footer">
            <span
              >{{
              pageParameters.index * pageParameters.size +
              1 +
              ' - ' +
              ((pageParameters.index + 1) * pageParameters.size > totalCount
              ? totalCount
              : (pageParameters.index + 1) * pageParameters.size)
              }}
              of {{ totalCount }}</span
              >
              <lib-shared-ui-paginator
                [totalCount]="totalCount"
                [pageIndex]="pageParameters.index"
                [pageSize]="pageParameters.size"
                [pageSizeOptions]="[5, 10, 15]"
                (page)="page.emit($event)"
              ></lib-shared-ui-paginator>
            </div>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>

  <ng-template #defaultCell let-item="item" let-col="col">
    <span>{{ item[col] ?? '-' }}</span>
  </ng-template>

  <ng-template #sortHeader let-column="column">
    <lib-sortable-header
      [sortDefinition]="sortDefinition"
      [column]="column"
      (sort)="onSort($event)"
    ></lib-sortable-header>
  </ng-template>
